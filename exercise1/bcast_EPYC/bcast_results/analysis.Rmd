---
title: "analysis"
author: "Giulio Fantuzzi"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(ggplot2)
library(dplyr)
library(tidyverse)
library(patchwork)
```

# Table of contents
- [Broadcast analysis](#broadcast-analysis)
  - [ Fix algorithm and see how latency changes when allocation varies](#fix-algorithm-and-see-how-latency-changes-when-allocation-varies)
    - [Bcast linear](#bcast-linear)
    - [Bcast chain](#bcast-chain)
  - [Fix map allocation and compare different algorithms](#fix-map-allocation-and-compare-different-algorithms)
    - [Comparing Linear vs Chain](#comparing-linear-vs-chain)
    - [Comparing all Bcast algorithms](#comparing-all-bcast-algorithms)
  - [Fix algorithm and allocation and see how latency changes when message size varies](#fix-algorithm-and-allocation-and-see-how-latency-changes-when-message-size-varies)
    - [Linear](#linear)
    - [Chain](#chain)
    - [BinaryTree](#binary-tree)
  

# Broadcast analysis

First of all, import the datasets i obtained from *ORFEO*
```{r}
bcast_default.df<- read.csv(file = "bcast_default.csv")
bcast_linear.df<- read.csv(file = "bcast_linear.csv")
bcast_chain.df<- read.csv(file = "bcast_chain.csv")
bcast_binarytree.df<- read.csv(file = "bcast_binarytree.csv")
```

Now we can bind them into a single df:
```{r}
bcast.df<- rbind(bcast_default.df,bcast_linear.df,bcast_chain.df,bcast_binarytree.df)
```

# Algs comparison
```{r}
bcast.df %>%
  ggplot(aes(x = Processes, y = AvgLatency.us., color = Algorithm)) +
    geom_line(linetype = 1) +
    geom_point(size=0)+
    geom_vline(xintercept = c(64, 128,192), linetype = "dashed", color = "#616A6B")+
    annotate("text", x = c(64,128,192), y = c(0,0,0), label = c("64 Cores","128 Cores","192 Cores"), vjust = 0, hjust = -0.1,color="#616A6B")+
    scale_color_manual(values = c("#27AE60","#E67E22","#3498DB","red")) +
    xlim(2, 256) +  # Adjust the x-axis limits as needed
    labs(x = 'N. of processes (#cores)',
         y = 'Latency',
         title = 'Broadcast Latency vs #cores (MessageSize = 2)',
         color = 'Algorithm')+
    theme_light()
```

```{r}
bcast_default_complete.df<- read.csv(file = "bcast_default_complete.csv")
bcast_linear_complete.df<- read.csv(file = "bcast_linear_complete.csv")
bcast_chain_complete.df<- read.csv(file = "bcast_chain_complete.csv")
bcast_binarytree_complete.df<- read.csv(file = "bcast_binarytree_complete.csv")
bcast_complete.df<- rbind(bcast_default_complete.df,bcast_linear_complete.df,bcast_chain_complete.df,bcast_binarytree_complete.df)
```


# Allocation comparison (for linear)
```{r}
bcast_complete.df %>% filter(Algorithm=="Linear") %>%  filter(MessageSize==256) %>%
  ggplot(aes(x = Processes, y = Latency, color = Allocation)) +
    geom_line(linetype = 1) +
    geom_point(size=0)+
    geom_vline(xintercept = c(64, 128,192), linetype = "dashed", color = "#616A6B")+
    annotate("text", x = c(64,128,192), y = c(0,0,0), label = c("64 Cores","128 Cores","192 Cores"), vjust = 0, hjust = -0.1,color="#616A6B")+
    scale_color_manual(values = c("#27AE60","#E67E22","#3498DB")) +
    xlim(2, 256) +  # Adjust the x-axis limits as needed
    labs(x = 'N. of processes (#cores)',
         y = 'Latency',
         title = 'Broadcast Latency vs #cores (MessageSize = 2)',
         color = 'Allocation')+
    theme_light()
```

```{r}
bcast_complete.df %>% filter(Algorithm=="Linear") %>% filter(Allocation=="core") %>% filter(MessageSize==2) %>%
  ggplot(aes(x = Processes, y = Latency)) +
    geom_line(linetype = 1) +
    geom_point(size=0)+
    geom_vline(xintercept = c(64, 128,192), linetype = "dashed", color = "#616A6B")+
    annotate("text", x = c(64,128,192), y = c(0,0,0), label = c("64 Cores","128 Cores","192 Cores"), vjust = 0, hjust = -0.1,color="#616A6B")+
    #scale_color_manual(values = c("#27AE60","#E67E22","#3498DB")) +
    xlim(2, 256) +  # Adjust the x-axis limits as needed
    labs(x = 'N. of processes (#cores)',
         y = 'Latency',
         title = 'Broadcast Latency vs #cores (MessageSize = 2)')+
    theme_light()
```